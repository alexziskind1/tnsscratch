"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Observable_1 = require("rxjs/Observable");
require("rxjs");
var page_1 = require("ui/page");
var rxjs_1 = require("rxjs");
var d3 = require("d3-ease");
var mkPt = function (x, y) { return { x: x, y: y }; };
/*
const msElapsed = (scheduler = Scheduler.animationFrame) =>
    Observable.defer(() => {
        const start = scheduler.now();
        return Observable.interval(0, scheduler)
            .map(() => scheduler.now() - start);
    });
        */
var msElapsed = function (scheduler) {
    if (scheduler === void 0) { scheduler = rxjs_1.Scheduler.animationFrame; }
    return Observable_1.Observable.defer(function () {
        var start = scheduler.now();
        return Observable_1.Observable.interval(0, scheduler)
            .map(function () { return scheduler.now() - start; });
    });
};
var duration = function (ms, scheduler) {
    if (scheduler === void 0) { scheduler = rxjs_1.Scheduler.animationFrame; }
    return msElapsed(scheduler)
        .map(function (elapsedMs) { return elapsedMs / ms; })
        .takeWhile(function (t) { return t <= 1; });
};
var amount = function (d) { return function (t) { return t * d; }; };
var amountRev = function (d, rev) {
    if (rev === void 0) { rev = false; }
    return function (t) {
        var ret = rev ? (1 - t) * d : t * d;
        return ret;
    };
};
var amountFromTo = function (range) {
    return function (t) {
        var ret = range.from + t * (range.to - range.from);
        return ret;
    };
};
var elasticOut = function (t) {
    return Math.sin(-13.0 * (t + 1.0) *
        Math.PI / 2) *
        Math.pow(2.0, -10.0 * t) +
        1.0;
};
//////////////////
var transformPoint = function (point) {
    return function (amtX, amtY) {
        if (amtX === void 0) { amtX = 0; }
        if (amtY === void 0) { amtY = 0; }
        return ({ x: point.x + amtX, y: point.y + amtY });
    };
};
var transformPath = function (path) {
    return function (amtX, amtY) {
        if (amtX === void 0) { amtX = 0; }
        if (amtY === void 0) { amtY = 0; }
        console.log("amtX: " + amtX + " , amtY: " + amtY);
        return path.map(function (p) { return transformPoint(p)(amtX, amtY); });
    };
};
var getClipPathValue = function (path) {
    var pieces = [];
    for (var i = 0; i < path.length; i++) {
        pieces.push(path[i].x + "% " + path[i].y + "%");
    }
    return "polygon(" + pieces.join(', ') + ")";
};
var clipPathValueToArray = function (polygon) {
    var vals = polygon.substring(polygon.indexOf('(') + 1, polygon.indexOf(')'));
    var pointStrings = vals.split(',').filter(function (x) { return x; });
    return pointStrings.map(function (pStr) {
        var ptParts = pStr.replace(/\%/g, '').split(' ').filter(function (x) { return x; });
        return mkPt(parseInt(ptParts[0]), parseInt(ptParts[1]));
    });
};
var ParalComponent = (function () {
    function ParalComponent(page, ngZone) {
        this.page = page;
        this.ngZone = ngZone;
        //private path: Point[] = [mkPt(25, 0), mkPt(100, 0), mkPt(75, 100), mkPt(0, 100)];
        this.pathVal = 'polygon(30% 0, 50% 0, 35% 100%, 15% 100%)';
        this.rev = true;
    }
    ParalComponent.prototype.ngOnInit = function () {
        var self = this;
        //let theLabel = this.labelRef.nativeElement;
        //let stack1 = this.stack1Ref.nativeElement;
    };
    ParalComponent.prototype.ngAfterViewInit = function () {
    };
    Object.defineProperty(ParalComponent.prototype, "range", {
        get: function () {
            return this.rev ? { from: 10, to: 150 } : { from: 150, to: 10 };
        },
        enumerable: true,
        configurable: true
    });
    ParalComponent.prototype.onParalClick = function (args) {
        var paral = args;
        var amtChange = 50;
        var path = clipPathValueToArray(this.pathVal);
        var tempPath = transformPath(path)(-amtChange);
        duration(500)
            .map(d3.easeElasticOut)
            .map(amount(amtChange))
            .map(function (amt) { return transformPath(tempPath)(amt); })
            .map(getClipPathValue)
            .do(function (newPathVal) { return paral.style.clipPath = newPathVal; })
            .subscribe();
    };
    ParalComponent.prototype.onPan = function (args) {
        console.log(args.state);
    };
    ParalComponent.prototype.onTouch = function (args) {
        console.log(args.action);
    };
    ParalComponent.prototype.handleError = function (e) {
        console.dir(e);
    };
    return ParalComponent;
}());
__decorate([
    core_1.ViewChild('lbl'),
    __metadata("design:type", core_1.ElementRef)
], ParalComponent.prototype, "labelRef", void 0);
__decorate([
    core_1.ViewChild('stack1'),
    __metadata("design:type", core_1.ElementRef)
], ParalComponent.prototype, "stack1Ref", void 0);
ParalComponent = __decorate([
    core_1.Component({
        selector: "paral",
        template: "\n    <StackLayout>\n        <Button text=\"TAP\" (tap)=\"onParalClick(lbl)\"></Button>\n        <Label #lbl class=\"paral\" (tap)=\"onParalClick(lbl)\"></Label>\n    </StackLayout>\n    ",
        styles: ["\n    .paral {\n        width: 100%;\n        height: 300px;\n        background-color: purple;\n        clip-path: polygon(-75% 0%, 0% 0%, -25% 100%, -100% 100%);\n        clip-path: polygon(30% 0, 50% 0, 35% 100%, 15% 100%);\n    }\n    "]
    }),
    __metadata("design:paramtypes", [page_1.Page, core_1.NgZone])
], ParalComponent);
exports.ParalComponent = ParalComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGFyYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWtHO0FBRWxHLDhDQUE2QztBQUc3QyxnQkFBYztBQUNkLGdDQUErQjtBQUcvQiw2QkFBaUM7QUFDakMsNEJBQThCO0FBTzlCLElBQU0sSUFBSSxHQUFHLFVBQUMsQ0FBUyxFQUFFLENBQVMsSUFBTyxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUEsRUFBRSxDQUFDLEdBQUEsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBSTVEOzs7Ozs7O1VBT1U7QUFFVixJQUFNLFNBQVMsR0FBRyxVQUFDLFNBQW9DO0lBQXBDLDBCQUFBLEVBQUEsWUFBWSxnQkFBUyxDQUFDLGNBQWM7SUFDbkQsT0FBQSx1QkFBVSxDQUFDLEtBQUssQ0FBQztRQUNiLElBQU0sS0FBSyxHQUFHLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5QixNQUFNLENBQUMsdUJBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQzthQUNuQyxHQUFHLENBQUMsY0FBTSxPQUFBLFNBQVMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLEVBQXZCLENBQXVCLENBQUMsQ0FBQztJQUM1QyxDQUFDLENBQUM7QUFKRixDQUlFLENBQUM7QUFFUCxJQUFNLFFBQVEsR0FBRyxVQUFDLEVBQUUsRUFBRSxTQUFvQztJQUFwQywwQkFBQSxFQUFBLFlBQVksZ0JBQVMsQ0FBQyxjQUFjO0lBQ3RELE9BQUEsU0FBUyxDQUFDLFNBQVMsQ0FBQztTQUNmLEdBQUcsQ0FBQyxVQUFBLFNBQVMsSUFBSSxPQUFBLFNBQVMsR0FBRyxFQUFFLEVBQWQsQ0FBYyxDQUFDO1NBQ2hDLFNBQVMsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsSUFBSSxDQUFDLEVBQU4sQ0FBTSxDQUFDO0FBRjNCLENBRTJCLENBQUM7QUFFaEMsSUFBTSxN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QXpERCxJQXlEQztBQXBEcUI7SUFBakIsZ0JBQVMsQ0FBQyxLQUFLLENBQUM7OEJBQVcsaUJBQVU7Z0RBQUM7QUFDbEI7SUFBcEIsZ0JBQVMsQ0FBQyxRQUFRLENBQUM7OEJBQVksaUJBQVU7aURBQUM7QUFObEMsY0FBYztJQW5CMUIsZ0JBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxPQUFPO1FBQ2pCLFFBQVEsRUFBRSw2TEFLVDtRQUNELE1BQU0sRUFBRSxDQUFDLGlQQVFSLENBQUM7S0FDTCxDQUFDO3FDQVc0QixXQUFJLEVBQWtCLGFBQU07R0FUN0MsY0FBYyxDQXlEMUI7QUF6RFksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIE5nWm9uZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqcy9PYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBQYW5HZXN0dXJlRXZlbnREYXRhLCBHZXN0dXJlVHlwZXMsIEdlc3R1cmVTdGF0ZVR5cGVzLCBHZXN0dXJlc09ic2VydmVyLCBUb3VjaEdlc3R1cmVFdmVudERhdGEgfSBmcm9tIFwidG5zLWNvcmUtbW9kdWxlcy91aS9nZXN0dXJlc1wiO1xuXG5pbXBvcnQgJ3J4anMnO1xuaW1wb3J0IHsgUGFnZSB9IGZyb20gXCJ1aS9wYWdlXCI7XG5pbXBvcnQgeyBMYWJlbCB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2xhYmVsL2xhYmVsXCI7XG5pbXBvcnQgKiBhcyBlbnVtcyBmcm9tIFwidWkvZW51bXNcIjtcbmltcG9ydCB7IFNjaGVkdWxlciB9IGZyb20gXCJyeGpzXCI7XG5pbXBvcnQgKiBhcyBkMyBmcm9tICdkMy1lYXNlJztcblxuXG5pbnRlcmZhY2UgUG9pbnQge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG59XG5jb25zdCBta1B0ID0gKHg6IG51bWJlciwgeTogbnVtYmVyKSA9PiB7IHJldHVybiB7IHgsIHkgfTsgfTtcblxuXG5cbi8qXG5jb25zdCBtc0VsYXBzZWQgPSAoc2NoZWR1bGVyID0gU2NoZWR1bGVyLmFuaW1hdGlvbkZyYW1lKSA9PlxuICAgIE9ic2VydmFibGUuZGVmZXIoKCkgPT4ge1xuICAgICAgICBjb25zdCBzdGFydCA9IHNjaGVkdWxlci5ub3coKTtcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuaW50ZXJ2YWwoMCwgc2NoZWR1bGVyKVxuICAgICAgICAgICAgLm1hcCgoKSA9PiBzY2hlZHVsZXIubm93KCkgLSBzdGFydCk7XG4gICAgfSk7XG4gICAgICAgICovXG5cbmNvbnN0IG1zRWxhcHNlZCA9IChzY2hlZHVsZXIgPSBTY2hlZHVsZXIuYW5pbWF0aW9uRnJhbWUpID0+XG4gICAgT2JzZXJ2YWJsZS5kZWZlcigoKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gc2NoZWR1bGVyLm5vdygpO1xuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5pbnRlcnZhbCgwLCBzY2hlZHVsZXIpXG4gICAgICAgICAgICAubWFwKCgpID0+IHNjaGVkdWxlci5ub3coKSAtIHN0YXJ0KTtcbiAgICB9KTtcblxuY29uc3QgZHVyYXRpb24gPSAobXMsIHNjaGVkdWxlciA9IFNjaGVkdWxlci5hbmltYXRpb25GcmFtZSkgPT5cbiAgICBtc0VsYXBzZWQoc2NoZWR1bGVyKVxuICAgICAgICAubWFwKGVsYXBzZWRNcyA9PiBlbGFwc2VkTXMgLyBtcylcbiAgICAgICAgLnRha2VXaGlsZSh0ID0+IHQgPD0gMSk7XG5cbmNvbnN0IGFtb3VudCA9IChkKSA9PiAodCkgPT4gdCAqIGQ7XG5cbmNvbnN0IGFtb3VudFJldiA9IGZ1bmN0aW9uIChkLCByZXYgPSBmYWxzZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xuICAgICAgICBjb25zdCByZXQgPSByZXYgPyAoMSAtIHQpICogZCA6IHQgKiBkO1xuICAgICAgICByZXR1cm4gcmV0O1xuICAgIH07XG59O1xuXG5jb25zdCBhbW91bnRGcm9tVG8gPSBmdW5jdGlvbiAocmFuZ2UpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgY29uc3QgcmV0ID0gcmFuZ2UuZnJvbSArIHQgKiAocmFuZ2UudG8gLSByYW5nZS5mcm9tKTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xufTtcblxuY29uc3QgZWxhc3RpY091dCA9ICh0KSA9PiB7XG4gICAgcmV0dXJuIE1hdGguc2luKC0xMy4wICogKHQgKyAxLjApICpcbiAgICAgICAgTWF0aC5QSSAvIDIpICpcbiAgICAgICAgTWF0aC5wb3coMi4wLCAtMTAuMCAqIHQpICtcbiAgICAgICAgMS4wXG59O1xuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbmNvbnN0IHRyYW5zZm9ybVBvaW50ID0gKHBvaW50OiBQb2ludCkgPT5cbiAgICAoYW10WDogbnVtYmVyID0gMCwgYW10WTogbnVtYmVyID0gMCkgPT5cbiAgICAgICAgKHsgeDogcG9pbnQueCArIGFtdFgsIHk6IHBvaW50LnkgKyBhbXRZIH0pO1xuXG5cbmNvbnN0IHRyYW5zZm9ybVBhdGggPSAocGF0aDogUG9pbnRbXSkgPT4ge1xuICAgIHJldHVybiAoYW10WDogbnVtYmVyID0gMCwgYW10WTogbnVtYmVyID0gMCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgYW10WDogJHthbXRYfSAsIGFtdFk6ICR7YW10WX1gKTtcbiAgICAgICAgcmV0dXJuIHBhdGgubWFwKHAgPT4gdHJhbnNmb3JtUG9pbnQocCkoYW10WCwgYW10WSkpO1xuICAgIH07XG59O1xuXG5jb25zdCBnZXRDbGlwUGF0aFZhbHVlID0gKHBhdGg6IFBvaW50W10pOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IHBpZWNlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgICBwaWVjZXMucHVzaChgJHtwYXRoW2ldLnh9JSAke3BhdGhbaV0ueX0lYCk7XG4gICAgfVxuICAgIHJldHVybiBgcG9seWdvbigke3BpZWNlcy5qb2luKCcsICcpfSlgO1xufTtcblxuY29uc3QgY2xpcFBhdGhWYWx1ZVRvQXJyYXkgPSAocG9seWdvbjogc3RyaW5nKTogUG9pbnRbXSA9PiB7XG4gICAgY29uc3QgdmFscyA9IHBvbHlnb24uc3Vic3RyaW5nKHBvbHlnb24uaW5kZXhPZignKCcpICsgMSwgcG9seWdvbi5pbmRleE9mKCcpJykpO1xuICAgIGNvbnN0IHBvaW50U3RyaW5ncyA9IHZhbHMuc3BsaXQoJywnKS5maWx0ZXIoeCA9PiB4KTtcbiAgICByZXR1cm4gcG9pbnRTdHJpbmdzLm1hcChwU3RyID0+IHtcbiAgICAgICAgY29uc3QgcHRQYXJ0cyA9IHBTdHIucmVwbGFjZSgvXFwlL2csICcnKS5zcGxpdCgnICcpLmZpbHRlcih4ID0+IHgpO1xuICAgICAgICByZXR1cm4gbWtQdChwYXJzZUludChwdFBhcnRzWzBdKSwgcGFyc2VJbnQocHRQYXJ0c1sxXSkpO1xuICAgIH0pO1xufTtcblxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJwYXJhbFwiLFxuICAgIHRlbXBsYXRlOiBgXG4gICAgPFN0YWNrTGF5b3V0PlxuICAgICAgICA8QnV0dG9uIHRleHQ9XCJUQVBcIiAodGFwKT1cIm9uUGFyYWxDbGljayhsYmwpXCI+PC9CdXR0b24+XG4gICAgICAgIDxMYWJlbCAjbGJsIGNsYXNzPVwicGFyYWxcIiAodGFwKT1cIm9uUGFyYWxDbGljayhsYmwpXCI+PC9MYWJlbD5cbiAgICA8L1N0YWNrTGF5b3V0PlxuICAgIGAsXG4gICAgc3R5bGVzOiBbYFxuICAgIC5wYXJhbCB7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDMwMHB4O1xuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBwdXJwbGU7XG4gICAgICAgIGNsaXAtcGF0aDogcG9seWdvbigtNzUlIDAlLCAwJSAwJSwgLTI1JSAxMDAlLCAtMTAwJSAxMDAlKTtcbiAgICAgICAgY2xpcC1wYXRoOiBwb2x5Z29uKDMwJSAwLCA1MCUgMCwgMzUlIDEwMCUsIDE1JSAxMDAlKTtcbiAgICB9XG4gICAgYF1cbn0pXG5cbmV4cG9ydCBjbGFzcyBQYXJhbENvbXBvbmVudCB7XG5cbiAgICAvL3ByaXZhdGUgcGF0aDogUG9pbnRbXSA9IFtta1B0KDI1LCAwKSwgbWtQdCgxMDAsIDApLCBta1B0KDc1LCAxMDApLCBta1B0KDAsIDEwMCldO1xuICAgIHByaXZhdGUgcGF0aFZhbCA9ICdwb2x5Z29uKDMwJSAwLCA1MCUgMCwgMzUlIDEwMCUsIDE1JSAxMDAlKSc7XG5cbiAgICBAVmlld0NoaWxkKCdsYmwnKSBsYWJlbFJlZjogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdzdGFjazEnKSBzdGFjazFSZWY6IEVsZW1lbnRSZWY7XG5cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcGFnZTogUGFnZSwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSkge1xuXG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgICAvL2xldCB0aGVMYWJlbCA9IHRoaXMubGFiZWxSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgICAgLy9sZXQgc3RhY2sxID0gdGhpcy5zdGFjazFSZWYubmF0aXZlRWxlbWVudDtcbiAgICB9XG5cbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIHJldiA9IHRydWU7XG4gICAgcHJpdmF0ZSBnZXQgcmFuZ2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJldiA/IHsgZnJvbTogMTAsIHRvOiAxNTAgfSA6IHsgZnJvbTogMTUwLCB0bzogMTAgfTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25QYXJhbENsaWNrKGFyZ3MpIHtcbiAgICAgICAgY29uc3QgcGFyYWwgPSBhcmdzO1xuICAgICAgICBjb25zdCBhbXRDaGFuZ2UgPSA1MDtcbiAgICAgICAgY29uc3QgcGF0aCA9IGNsaXBQYXRoVmFsdWVUb0FycmF5KHRoaXMucGF0aFZhbCk7XG4gICAgICAgIGNvbnN0IHRlbXBQYXRoID0gdHJhbnNmb3JtUGF0aChwYXRoKSgtYW10Q2hhbmdlKTtcblxuICAgICAgICBkdXJhdGlvbig1MDApXG4gICAgICAgICAgICAubWFwKGQzLmVhc2VFbGFzdGljT3V0KVxuICAgICAgICAgICAgLm1hcChhbW91bnQoYW10Q2hhbmdlKSlcbiAgICAgICAgICAgIC5tYXAoYW10ID0+IHRyYW5zZm9ybVBhdGgodGVtcFBhdGgpKGFtdCkpXG4gICAgICAgICAgICAubWFwKGdldENsaXBQYXRoVmFsdWUpXG4gICAgICAgICAgICAuZG8obmV3UGF0aFZhbCA9PiBwYXJhbC5zdHlsZS5jbGlwUGF0aCA9IG5ld1BhdGhWYWwpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgb25QYW4oYXJnczogUGFuR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZyhhcmdzLnN0YXRlKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgb25Ub3VjaChhcmdzOiBUb3VjaEdlc3R1cmVFdmVudERhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coYXJncy5hY3Rpb24pO1xuICAgIH1cblxuICAgIHB1YmxpYyBoYW5kbGVFcnJvcihlKSB7XG4gICAgICAgIGNvbnNvbGUuZGlyKGUpO1xuICAgIH1cblxufVxuIl19