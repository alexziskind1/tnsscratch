"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var gestures_1 = require("ui/gestures");
var button_1 = require("ui/button");
var absolute_layout_1 = require("ui/layouts/absolute-layout");
var color_1 = require("color");
var guid_1 = require("./common/guid");
var navigationModule = require("./common/navigation");
var myglobalModule = require("./common/myglobal");
var geometry_1 = require("./common/geometry");
var linkItem_1 = require("./model/linkItem");
var linkView_1 = require("./views/linkView");
var imageView_1 = require("./views/imageView");
var RootPageController = (function (_super) {
    __extends(RootPageController, _super);
    function RootPageController() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.isInEditMode = false;
        _this.linkViews = [];
        //private pageSize: Size;
        _this.message = "hi there";
        _this.currentRect = new absolute_layout_1.AbsoluteLayout();
        _this.selectRectId = "currentRect";
        _this.layoutBaseId = "layoutBase";
        _this.editBtnId = "editBtn";
        _this.wrapperClassNameProp = "wrapperClassName";
        _this.wrapEditClassName = "wrapper";
        _this.startPoint = new geometry_1.Point(0, 0);
        _this.selRect = new geometry_1.Rect(0, 0, 0, 0);
        _this.longPressDone = true;
        return _this;
    }
    RootPageController.prototype.pageSize = function () {
        var height = this.page.getMeasuredHeight();
        var width = this.page.getMeasuredWidth();
        return new geometry_1.Size(width, height);
    };
    RootPageController.prototype.pageLoaded = function (args) {
        var _this = this;
        var height = this.page.getMeasuredHeight();
        var width = this.page.getMeasuredWidth();
        //this.pageSize = new Size(width, height);
        this.set("message", "height: " + height + ", width: " + width);
        if (myglobalModule.firstLoad) {
            //this.imageView.requestLayout();
            myglobalModule.firstLoad = false;
        }
        myglobalModule.pageSize = this.pageSize();
        this.currentRect.id = this.selectRectId;
        this.currentRect.style.backgroundColor = new color_1.Color(150, 100, 100, 100);
        var makeBtn = new button_1.Button();
        makeBtn.text = "make";
        makeBtn.id = this.editBtnId;
        makeBtn.opacity = 0;
        makeBtn.className = "btn-convert";
        makeBtn.on('tap', function () {
            var li = new linkItem_1.LinkItem(guid_1.Guid.newGuid(), '', _this.selRect, _this.pageSize(), false);
            _this.currentNavPage.linkItems.push(li);
            _this.drawLink(li);
            _this.clearSelection();
        });
        this.currentRect.addChild(makeBtn);
    };
    RootPageController.prototype.navigatingTo = function (args) {
        this.page = args.object;
        this.page.bindingContext = this;
        //this.pageImg = <Image>this.page.getViewById("pageImg");
        this.layout = this.page.getViewById(this.layoutBaseId);
        if (args.context != null) {
            this.currentNavPage = args.context;
        }
        else {
            this.currentNavPage = navigationModule.navigation.startPage();
        }
        this.setImage(this.currentNavPage.name);
    };
    RootPageController.prototype.tapAction = function (args) {
        this.setImage(this.currentNavPage.name);
    };
    RootPageController.prototype.tapPage = function (arg1) {
        console.log('tapPage');
        this.clearSelection();
        if (this.isInEditMode || !this.longPressDone) {
            return;
        }
        var x = arg1.ios.locationInView(arg1.ios.view).x;
        var y = arg1.ios.locationInView(arg1.ios.view).y;
        var hitPoint = new geometry_1.Point(x, y);
        var matchedLink;
        for (var i = 0; i < this.currentNavPage.linkItems.length; i++) {
            var li = this.currentNavPage.linkItems[i];
            if (li.isHitTestPositive(hitPoint, this.pageSize())) {
                matchedLink = li;
                break;
            }
        }
        /*
                this.currentNavPage.linkItems.forEach(l=> {
                    if (l.isHitTestPositive(hitPoint, this.pageSize)) {
                        matchedLink = l;
                    }
                });
                */
        if (matchedLink != null) {
            if (matchedLink.isBack) {
                navigationModule.navigation.goBack();
            }
            else {
                var nextPage = navigationModule.navigation.getPageByName(matchedLink.name);
                navigationModule.navigation.goToRoot(nextPage);
            }
        }
        else {
            this.flashValidLinks();
        }
    };
    RootPageController.prototype.flashValidLinks = function () {
        var _this = this;
        this.drawLinks(this.currentNavPage.linkItems)
            .then(function () {
            _this.exitEditMode();
        });
    };
    RootPageController.prototype.panPage = function (arg1) {
        if (!this.isInEditMode) {
            return;
        }
        switch (arg1.state) {
            case gestures_1.GestureStateTypes.began:
                this.selRect.origin.x = arg1.ios.locationInView(arg1.ios.view).x;
                this.selRect.origin.y = arg1.ios.locationInView(arg1.ios.view).y;
                this.startPoint.x = this.selRect.origin.x;
                this.startPoint.y = this.selRect.origin.y;
                this.selRect.size.width = 0;
                this.selRect.size.height = 0;
                this.drawRectUpdate(arg1.state);
                break;
            case gestures_1.GestureStateTypes.changed:
                if (arg1.deltaX < 0) {
                    this.selRect.size.width = Math.abs(arg1.deltaX);
                    this.selRect.origin.x = this.startPoint.x - this.selRect.size.width;
                }
                else {
                    this.selRect.size.width = arg1.deltaX;
                }
                if (arg1.deltaY < 0) {
                    this.selRect.size.height = Math.abs(arg1.deltaY);
                    this.selRect.origin.y = this.startPoint.y - this.selRect.size.height;
                }
                else {
                    this.selRect.size.height = arg1.deltaY;
                }
                if (this.selRect.origin.x < 0)
                    this.selRect.origin.x = 0;
                if (this.selRect.origin.y < 0)
                    this.selRect.origin.y = 0;
                this.drawRectUpdate(arg1.state);
                break;
            case gestures_1.GestureStateTypes.ended:
                this.showEditBtn();
                break;
        }
    };
    RootPageController.prototype.showEditBtn = function (duration) {
        if (duration === void 0) { duration = 250; }
        return this.toggleEditBtn(true, duration);
    };
    RootPageController.prototype.hideEditBtn = function (duration) {
        if (duration === void 0) { duration = 250; }
        return this.toggleEditBtn(false, duration);
    };
    RootPageController.prototype.toggleEditBtn = function (show, duration) {
        var ch = this.layout.getViewById(this.selectRectId);
        if (ch != null) {
            var editBtn = ch.getViewById(this.editBtnId);
            return editBtn.animate({
                opacity: show ? 1 : 0,
                duration: duration
            });
        }
    };
    RootPageController.prototype.drawRectUpdate = function (state) {
        if (state == gestures_1.GestureStateTypes.began) {
            this.hideEditBtn(1);
        }
        absolute_layout_1.AbsoluteLayout.setTop(this.currentRect, this.selRect.origin.y);
        absolute_layout_1.AbsoluteLayout.setLeft(this.currentRect, this.selRect.origin.x);
        this.currentRect.width = this.selRect.size.width;
        this.currentRect.height = this.selRect.size.height;
        var ch = this.layout.getViewById(this.selectRectId);
        if (ch == null)
            this.layout.addChild(this.currentRect);
    };
    RootPageController.prototype.clearSelection = function () {
        var _this = this;
        var ch = this.layout.getViewById(this.selectRectId);
        if (ch != null) {
            var p = this.hideEditBtn(1);
            if (p != null) {
                p.then(function () {
                    _this.layout.removeChild(ch);
                });
            }
        }
    };
    RootPageController.prototype.doubleTap = function (arg1) {
        console.log('double tap');
    };
    RootPageController.prototype.longPress = function (arg1) {
        //dialogs.action("Your message", "Cancel button text", ["Option1", "Option2", "Option2", "Option2", "Option2", "Option2", "Option2", "Option2", "Option2", "Option2"]).then(result => {
        //    console.log("Dialog result: " + result)
        //});
        var _this = this;
        //this.drawLinks(this.currentNavPage.linkItems);
        switch (arg1.ios.state) {
            case gestures_1.GestureStateTypes.began:
                if (this.isInEditMode) {
                    this.exitEditMode();
                }
                else {
                    this.enterEditMode();
                }
                this.longPressDone = false;
                break;
            case gestures_1.GestureStateTypes.changed:
                break;
            case gestures_1.GestureStateTypes.ended:
                console.log('longPress');
                setTimeout(function () { return _this.longPressDone = true; }, 500);
                break;
        }
    };
    RootPageController.prototype.enterEditMode = function () {
        this.isInEditMode = true;
        this.drawLinks(this.currentNavPage.linkItems);
        this.set(this.wrapperClassNameProp, this.wrapEditClassName);
    };
    RootPageController.prototype.drawLinks = function (linkItems) {
        /*
        var pro = new Promise((res, rej)=>{
            this._resolve = res;
            this._reject = rej;
        });
        */
        var retPromises = [];
        for (var i = 0; i < linkItems.length; i++) {
            var li = linkItems[i];
            var drawPromise = this.drawLink(li);
            retPromises.push(drawPromise);
        }
        return Promise.all(retPromises);
    };
    RootPageController.prototype.drawLink = function (li) {
        var _this = this;
        var relRect = li.rect.changeRatio(li.parentSize, this.pageSize());
        var lv = new linkView_1.LinkView(li, relRect, function () { return _this.showLinkPicker(lv, li); });
        lv.opacity = 0;
        this.linkViews.push(lv);
        this.layout.addChild(lv);
        return lv.fadeIn();
    };
    RootPageController.prototype.exitEditMode = function () {
        this.isInEditMode = false;
        for (var i = 0; i < this.linkViews.length; i++) {
            var lv = this.linkViews[i];
            this.removeLinkView(lv);
            /*
            lv.fadeOut().then(()=>{
                try {
                    this.layout.removeChild(lv);
                }
                catch (ex) { }
            });
            */
        }
        this.linkViews = [];
        this.set(this.wrapperClassNameProp, "");
    };
    RootPageController.prototype.showLinkPicker = function (lv, li) {
        var _this = this;
        var fullscreen = true;
        this.page.showModal("./linkPicker", li.name, function (args) {
            console.log("rootPage received LinkPickerClosedEventArgs");
            if (args.canceled) {
                return;
            }
            if (args.linkDeleted) {
                var liIdx = _this.currentNavPage.linkItems.map(function (x) { return x.id; }).indexOf(li.id);
                //var liIdx = this.currentNavPage.linkItems.indexOf(li);
                var lvIdx = _this.linkViews.map(function (x) { return x.linkItem.id; }).indexOf(lv.linkItem.id);
                //var lvIdx = this.linkViews.indexOf(lv);
                _this.currentNavPage.linkItems.splice(liIdx, 1);
                _this.removeLinkView(lv);
                _this.linkViews.splice(lvIdx, 1);
            }
            else {
                li.name = args.selectedName;
            }
        }, fullscreen);
    };
    RootPageController.prototype.removeLinkView = function (lv) {
        var _this = this;
        //var lvIdx = this.linkViews.indexOf(lv);
        //this.linkViews.splice(lvIdx,1);
        lv.fadeOut().then(function () {
            try {
                _this.layout.removeChild(lv);
            }
            catch (ex) {
                console.error("failed removing lv from layout. " + ex.message);
            }
        });
    };
    RootPageController.prototype.setImage = function (name) {
        this.imageView = new imageView_1.ImageView();
        this.imageView.src = "~/images/" + name + ".png";
        this.layout.addChild(this.imageView);
        /*
        this.pageImg = new Image();
        this.pageImg.src = "~/images/" + name + ".png";
        this.layout.addChild(this.pageImg);
        */
        //this.pageImg.imageSource = imageSourceModule.fromResource(name + ".png");
        //this.pageImg.stretch = enumsModule.Stretch.aspectFit;
    };
    return RootPageController;
}(observable_1.Observable));
var pc = new RootPageController();
exports.pageLoaded = function (args) { return pc.pageLoaded(args); };
exports.navigatingTo = function (args) { return pc.navigatingTo(args); };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm9vdFBhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJyb290UGFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUE2QztBQUM3Qyx3Q0FBZ0k7QUFHaEksb0NBQW1DO0FBRW5DLDhEQUE0RDtBQUs1RCwrQkFBOEI7QUFFOUIsc0NBQXFDO0FBR3JDLHNEQUF5RDtBQUN6RCxrREFBcUQ7QUFDckQsOENBQXNEO0FBQ3RELDZDQUE0QztBQUM1Qyw2Q0FBNEM7QUFDNUMsK0NBQThDO0FBTTlDO0lBQWlDLHNDQUFVO0lBQTNDO1FBQUEscUVBd1hDO1FBbFhXLGtCQUFZLEdBQVksS0FBSyxDQUFDO1FBQzlCLGVBQVMsR0FBb0IsRUFBRSxDQUFDO1FBQ3hDLHlCQUF5QjtRQUNsQixhQUFPLEdBQVcsVUFBVSxDQUFDO1FBQzVCLGlCQUFXLEdBQUcsSUFBSSxnQ0FBYyxFQUFFLENBQUM7UUFDbkMsa0JBQVksR0FBRyxhQUFhLENBQUM7UUFDN0Isa0JBQVksR0FBRyxZQUFZLENBQUM7UUFDNUIsZUFBUyxHQUFHLFNBQVMsQ0FBQztRQUN0QiwwQkFBb0IsR0FBRyxrQkFBa0IsQ0FBQztRQUMxQyx1QkFBaUIsR0FBRyxTQUFTLENBQUM7UUFrSDlCLGdCQUFVLEdBQVUsSUFBSSxnQkFBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwQyxhQUFPLEdBQVMsSUFBSSxlQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFtR3JDLG1CQUFhLEdBQUcsSUFBSSxDQUFDOztJQW1KakMsQ0FBQztJQXRXVyxxQ0FBUSxHQUFoQjtRQUNJLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUMzQyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDekMsTUFBTSxDQUFDLElBQUksZUFBSSxDQUFD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RUFBckIsQ0FBcUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XG5pbXBvcnQgeyBHZXN0dXJlRXZlbnREYXRhLCBHZXN0dXJlVHlwZXMsIEdlc3R1cmVTdGF0ZVR5cGVzLCBHZXN0dXJlRXZlbnREYXRhV2l0aFN0YXRlLCBQYW5HZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInVpL2dlc3R1cmVzXCI7XG5cbmltcG9ydCB7IFBhZ2UgfSBmcm9tIFwidWkvcGFnZVwiO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSBcInVpL2J1dHRvblwiO1xuaW1wb3J0IHsgSW1hZ2UgfSBmcm9tIFwidWkvaW1hZ2VcIjtcbmltcG9ydCB7IEFic29sdXRlTGF5b3V0IH0gZnJvbSBcInVpL2xheW91dHMvYWJzb2x1dGUtbGF5b3V0XCI7XG5cblxuXG5cbmltcG9ydCB7IENvbG9yIH0gZnJvbSBcImNvbG9yXCI7XG5cbmltcG9ydCB7IEd1aWQgfSBmcm9tIFwiLi9jb21tb24vZ3VpZFwiO1xuXG5pbXBvcnQgeyBOYXZQYWdlIH0gZnJvbSBcIi4vbW9kZWwvbmF2UGFnZVwiO1xuaW1wb3J0IG5hdmlnYXRpb25Nb2R1bGUgPSByZXF1aXJlKFwiLi9jb21tb24vbmF2aWdhdGlvblwiKTtcbmltcG9ydCBteWdsb2JhbE1vZHVsZSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9teWdsb2JhbFwiKTtcbmltcG9ydCB7IFBvaW50LCBTaXplLCBSZWN0IH0gZnJvbSBcIi4vY29tbW9uL2dlb21ldHJ5XCI7XG5pbXBvcnQgeyBMaW5rSXRlbSB9IGZyb20gXCIuL21vZGVsL2xpbmtJdGVtXCI7XG5pbXBvcnQgeyBMaW5rVmlldyB9IGZyb20gXCIuL3ZpZXdzL2xpbmtWaWV3XCI7XG5pbXBvcnQgeyBJbWFnZVZpZXcgfSBmcm9tIFwiLi92aWV3cy9pbWFnZVZpZXdcIjtcbmltcG9ydCB7IExpbmtQaWNrZXJDbG9zZWRFdmVudEFyZ3MgfSBmcm9tIFwiLi9jb21tb24vZXZlbnRzL2xpbmtQaWNrZXJFdmVudEFyZ3NcIjtcblxuXG5cblxuY2xhc3MgUm9vdFBhZ2VDb250cm9sbGVyIGV4dGVuZHMgT2JzZXJ2YWJsZSB7XG4gICAgcHJpdmF0ZSBwYWdlOiBQYWdlO1xuICAgIHByaXZhdGUgY3VycmVudE5hdlBhZ2U6IE5hdlBhZ2U7XG4gICAgLy9wcml2YXRlIHBhZ2VJbWc6IEltYWdlO1xuICAgIHByaXZhdGUgaW1hZ2VWaWV3OiBJbWFnZVZpZXc7XG4gICAgcHJpdmF0ZSBsYXlvdXQ6IEFic29sdXRlTGF5b3V0O1xuICAgIHByaXZhdGUgaXNJbkVkaXRNb2RlOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBsaW5rVmlld3M6IEFycmF5PExpbmtWaWV3PiA9IFtdO1xuICAgIC8vcHJpdmF0ZSBwYWdlU2l6ZTogU2l6ZTtcbiAgICBwdWJsaWMgbWVzc2FnZTogc3RyaW5nID0gXCJoaSB0aGVyZVwiO1xuICAgIHByaXZhdGUgY3VycmVudFJlY3QgPSBuZXcgQWJzb2x1dGVMYXlvdXQoKTtcbiAgICBwcml2YXRlIHNlbGVjdFJlY3RJZCA9IFwiY3VycmVudFJlY3RcIjtcbiAgICBwcml2YXRlIGxheW91dEJhc2VJZCA9IFwibGF5b3V0QmFzZVwiO1xuICAgIHByaXZhdGUgZWRpdEJ0bklkID0gXCJlZGl0QnRuXCI7XG4gICAgcHJpdmF0ZSB3cmFwcGVyQ2xhc3NOYW1lUHJvcCA9IFwid3JhcHBlckNsYXNzTmFtZVwiO1xuICAgIHByaXZhdGUgd3JhcEVkaXRDbGFzc05hbWUgPSBcIndyYXBwZXJcIjtcblxuXG4gICAgcHJpdmF0ZSBwYWdlU2l6ZSgpIHtcbiAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMucGFnZS5nZXRNZWFzdXJlZEhlaWdodCgpO1xuICAgICAgICB2YXIgd2lkdGggPSB0aGlzLnBhZ2UuZ2V0TWVhc3VyZWRXaWR0aCgpO1xuICAgICAgICByZXR1cm4gbmV3IFNpemUod2lkdGgsIGhlaWdodCk7XG4gICAgfVxuXG4gICAgcHVibGljIHBhZ2VMb2FkZWQoYXJncykge1xuICAgICAgICB2YXIgaGVpZ2h0ID0gdGhpcy5wYWdlLmdldE1lYXN1cmVkSGVpZ2h0KCk7XG4gICAgICAgIHZhciB3aWR0aCA9IHRoaXMucGFnZS5nZXRNZWFzdXJlZFdpZHRoKCk7XG4gICAgICAgIC8vdGhpcy5wYWdlU2l6ZSA9IG5ldyBTaXplKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICB0aGlzLnNldChcIm1lc3NhZ2VcIiwgXCJoZWlnaHQ6IFwiICsgaGVpZ2h0ICsgXCIsIHdpZHRoOiBcIiArIHdpZHRoKTtcbiAgICAgICAgaWYgKG15Z2xvYmFsTW9kdWxlLmZpcnN0TG9hZCkge1xuXG4gICAgICAgICAgICAvL3RoaXMuaW1hZ2VWaWV3LnJlcXVlc3RMYXlvdXQoKTtcblxuICAgICAgICAgICAgbXlnbG9iYWxNb2R1bGUuZmlyc3RMb2FkID0gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBteWdsb2JhbE1vZHVsZS5wYWdlU2l6ZSA9IHRoaXMucGFnZVNpemUoKTtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSZWN0LmlkID0gdGhpcy5zZWxlY3RSZWN0SWQ7XG4gICAgICAgIHRoaXMuY3VycmVudFJlY3Quc3R5bGUuYmFja2dyb3VuZENvbG9yID0gbmV3IENvbG9yKDE1MCwgMTAwLCAxMDAsIDEwMCk7XG4gICAgICAgIHZhciBtYWtlQnRuID0gbmV3IEJ1dHRvbigpO1xuICAgICAgICBtYWtlQnRuLnRleHQgPSBcIm1ha2VcIjtcbiAgICAgICAgbWFrZUJ0bi5pZCA9IHRoaXMuZWRpdEJ0bklkO1xuICAgICAgICBtYWtlQnRuLm9wYWNpdHkgPSAwO1xuICAgICAgICBtYWtlQnRuLmNsYXNzTmFtZSA9IFwiYnRuLWNvbnZlcnRcIjtcblxuICAgICAgICBtYWtlQnRuLm9uKCd0YXAnLCAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgbGk6IExpbmtJdGVtID0gbmV3IExpbmtJdGVtKEd1aWQubmV3R3VpZCgpLCAnJywgdGhpcy5zZWxSZWN0LCB0aGlzLnBhZ2VTaXplKCksIGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudE5hdlBhZ2UubGlua0l0ZW1zLnB1c2gobGkpO1xuICAgICAgICAgICAgdGhpcy5kcmF3TGluayhsaSk7XG4gICAgICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFJlY3QuYWRkQ2hpbGQobWFrZUJ0bik7XG4gICAgfVxuXG5cbiAgICBwdWJsaWMgbmF2aWdhdGluZ1RvKGFyZ3MpIHtcbiAgICAgICAgdGhpcy5wYWdlID0gPFBhZ2U+YXJncy5vYmplY3Q7XG4gICAgICAgIHRoaXMucGFnZS5iaW5kaW5nQ29udGV4dCA9IHRoaXM7XG5cblxuXG4gICAgICAgIC8vdGhpcy5wYWdlSW1nID0gPEltYWdlPnRoaXMucGFnZS5nZXRWaWV3QnlJZChcInBhZ2VJbWdcIik7XG4gICAgICAgIHRoaXMubGF5b3V0ID0gPEFic29sdXRlTGF5b3V0PnRoaXMucGFnZS5nZXRWaWV3QnlJZCh0aGlzLmxheW91dEJhc2VJZCk7XG5cbiAgICAgICAgaWYgKGFyZ3MuY29udGV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnROYXZQYWdlID0gYXJncy5jb250ZXh0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50TmF2UGFnZSA9IG5hdmlnYXRpb25Nb2R1bGUubmF2aWdhdGlvbi5zdGFydFBhZ2UoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldEltYWdlKHRoaXMuY3VycmVudE5hdlBhZ2UubmFtZSk7XG4gICAgfVxuXG4gICAgcHVibGljIHRhcEFjdGlvbihhcmdzKSB7XG4gICAgICAgIHRoaXMuc2V0SW1hZ2UodGhpcy5jdXJyZW50TmF2UGFnZS5uYW1lKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdGFwUGFnZShhcmcxOiBHZXN0dXJlRXZlbnREYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCd0YXBQYWdlJyk7XG4gICAgICAgIHRoaXMuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgaWYgKHRoaXMuaXNJbkVkaXRNb2RlIHx8ICF0aGlzLmxvbmdQcmVzc0RvbmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciB4ID0gYXJnMS5pb3MubG9jYXRpb25JblZpZXcoYXJnMS5pb3MudmlldykueDtcbiAgICAgICAgdmFyIHkgPSBhcmcxLmlvcy5sb2NhdGlvbkluVmlldyhhcmcxLmlvcy52aWV3KS55O1xuXG4gICAgICAgIHZhciBoaXRQb2ludDogUG9pbnQgPSBuZXcgUG9pbnQoeCwgeSk7XG4gICAgICAgIHZhciBtYXRjaGVkTGluazogTGlua0l0ZW07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmN1cnJlbnROYXZQYWdlLmxpbmtJdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGxpID0gdGhpcy5jdXJyZW50TmF2UGFnZS5saW5rSXRlbXNbaV07XG4gICAgICAgICAgICBpZiAobGkuaXNIaXRUZXN0UG9zaXRpdmUoaGl0UG9pbnQsIHRoaXMucGFnZVNpemUoKSkpIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVkTGluayA9IGxpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLypcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnROYXZQYWdlLmxpbmtJdGVtcy5mb3JFYWNoKGw9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsLmlzSGl0VGVzdFBvc2l0aXZlKGhpdFBvaW50LCB0aGlzLnBhZ2VTaXplKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZExpbmsgPSBsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgKi9cblxuICAgICAgICBpZiAobWF0Y2hlZExpbmsgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKG1hdGNoZWRMaW5rLmlzQmFjaykge1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25Nb2R1bGUubmF2aWdhdGlvbi5nb0JhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBuZXh0UGFnZSA9IG5hdmlnYXRpb25Nb2R1bGUubmF2aWdhdGlvbi5nZXRQYWdlQnlOYW1lKG1hdGNoZWRMaW5rLm5hbWUpO1xuICAgICAgICAgICAgICAgIG5hdmlnYXRpb25Nb2R1bGUubmF2aWdhdGlvbi5nb1RvUm9vdChuZXh0UGFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZsYXNoVmFsaWRMaW5rcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmbGFzaFZhbGlkTGlua3MoKSB7XG4gICAgICAgIHRoaXMuZHJhd0xpbmtzKHRoaXMuY3VycmVudE5hdlBhZ2UubGlua0l0ZW1zKVxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZXhpdEVkaXRNb2RlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN0YXJ0UG9pbnQ6IFBvaW50ID0gbmV3IFBvaW50KDAsIDApO1xuICAgIHByaXZhdGUgc2VsUmVjdDogUmVjdCA9IG5ldyBSZWN0KDAsIDAsIDAsIDApO1xuXG4gICAgcHVibGljIHBhblBhZ2UoYXJnMTogUGFuR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgICAgICBpZiAoIXRoaXMuaXNJbkVkaXRNb2RlKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBzd2l0Y2ggKGFyZzEuc3RhdGUpIHtcbiAgICAgICAgICAgIGNhc2UgR2VzdHVyZVN0YXRlVHlwZXMuYmVnYW46XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxSZWN0Lm9yaWdpbi54ID0gYXJnMS5pb3MubG9jYXRpb25JblZpZXcoYXJnMS5pb3MudmlldykueDtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbFJlY3Qub3JpZ2luLnkgPSBhcmcxLmlvcy5sb2NhdGlvbkluVmlldyhhcmcxLmlvcy52aWV3KS55O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb2ludC54ID0gdGhpcy5zZWxSZWN0Lm9yaWdpbi54O1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRQb2ludC55ID0gdGhpcy5zZWxSZWN0Lm9yaWdpbi55O1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsUmVjdC5zaXplLndpZHRoID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbFJlY3Quc2l6ZS5oZWlnaHQgPSAwO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3UmVjdFVwZGF0ZShhcmcxLnN0YXRlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgR2VzdHVyZVN0YXRlVHlwZXMuY2hhbmdlZDpcbiAgICAgICAgICAgICAgICBpZiAoYXJnMS5kZWx0YVggPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsUmVjdC5zaXplLndpZHRoID0gTWF0aC5hYnMoYXJnMS5kZWx0YVgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbFJlY3Qub3JpZ2luLnggPSB0aGlzLnN0YXJ0UG9pbnQueCAtIHRoaXMuc2VsUmVjdC5zaXplLndpZHRoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxSZWN0LnNpemUud2lkdGggPSBhcmcxLmRlbHRhWDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFyZzEuZGVsdGFZIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbFJlY3Quc2l6ZS5oZWlnaHQgPSBNYXRoLmFicyhhcmcxLmRlbHRhWSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsUmVjdC5vcmlnaW4ueSA9IHRoaXMuc3RhcnRQb2ludC55IC0gdGhpcy5zZWxSZWN0LnNpemUuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxSZWN0LnNpemUuaGVpZ2h0ID0gYXJnMS5kZWx0YVk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsUmVjdC5vcmlnaW4ueCA8IDApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsUmVjdC5vcmlnaW4ueCA9IDA7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsUmVjdC5vcmlnaW4ueSA8IDApXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsUmVjdC5vcmlnaW4ueSA9IDA7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdSZWN0VXBkYXRlKGFyZzEuc3RhdGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBHZXN0dXJlU3RhdGVUeXBlcy5lbmRlZDpcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dFZGl0QnRuKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHNob3dFZGl0QnRuKGR1cmF0aW9uOiBudW1iZXIgPSAyNTApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9nZ2xlRWRpdEJ0bih0cnVlLCBkdXJhdGlvbik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBoaWRlRWRpdEJ0bihkdXJhdGlvbjogbnVtYmVyID0gMjUwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRvZ2dsZUVkaXRCdG4oZmFsc2UsIGR1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRvZ2dsZUVkaXRCdG4oc2hvdzogYm9vbGVhbiwgZHVyYXRpb246IG51bWJlcikge1xuICAgICAgICB2YXIgY2g6IEFic29sdXRlTGF5b3V0ID0gPEFic29sdXRlTGF5b3V0PnRoaXMubGF5b3V0LmdldFZpZXdCeUlkKHRoaXMuc2VsZWN0UmVjdElkKTtcbiAgICAgICAgaWYgKGNoICE9IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBlZGl0QnRuOiBCdXR0b24gPSA8QnV0dG9uPmNoLmdldFZpZXdCeUlkKHRoaXMuZWRpdEJ0bklkKTtcbiAgICAgICAgICAgIHJldHVybiBlZGl0QnRuLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIG9wYWNpdHk6IHNob3cgPyAxIDogMCxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb25cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGRyYXdSZWN0VXBkYXRlKHN0YXRlOiBHZXN0dXJlU3RhdGVUeXBlcykge1xuICAgICAgICBpZiAoc3RhdGUgPT0gR2VzdHVyZVN0YXRlVHlwZXMuYmVnYW4pIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUVkaXRCdG4oMSk7XG4gICAgICAgIH1cbiAgICAgICAgQWJzb2x1dGVMYXlvdXQuc2V0VG9wKHRoaXMuY3VycmVudFJlY3QsIHRoaXMuc2VsUmVjdC5vcmlnaW4ueSk7XG4gICAgICAgIEFic29sdXRlTGF5b3V0LnNldExlZnQodGhpcy5jdXJyZW50UmVjdCwgdGhpcy5zZWxSZWN0Lm9yaWdpbi54KTtcblxuICAgICAgICB0aGlzLmN1cnJlbnRSZWN0LndpZHRoID0gdGhpcy5zZWxSZWN0LnNpemUud2lkdGg7XG4gICAgICAgIHRoaXMuY3VycmVudFJlY3QuaGVpZ2h0ID0gdGhpcy5zZWxSZWN0LnNpemUuaGVpZ2h0O1xuXG4gICAgICAgIHZhciBjaDogQWJzb2x1dGVMYXlvdXQgPSA8QWJzb2x1dGVMYXlvdXQ+dGhpcy5sYXlvdXQuZ2V0Vmlld0J5SWQodGhpcy5zZWxlY3RSZWN0SWQpO1xuICAgICAgICBpZiAoY2ggPT0gbnVsbClcbiAgICAgICAgICAgIHRoaXMubGF5b3V0LmFkZENoaWxkKHRoaXMuY3VycmVudFJlY3QpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhclNlbGVjdGlvbigpIHtcbiAgICAgICAgdmFyIGNoOiBBYnNvbHV0ZUxheW91dCA9IDxBYnNvbHV0ZUxheW91dD50aGlzLmxheW91dC5nZXRWaWV3QnlJZCh0aGlzLnNlbGVjdFJlY3RJZCk7XG4gICAgICAgIGlmIChjaCAhPSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgcCA9IHRoaXMuaGlkZUVkaXRCdG4oMSk7XG4gICAgICAgICAgICBpZiAocCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXlvdXQucmVtb3ZlQ2hpbGQoY2gpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG5cblxuICAgIHB1YmxpYyBkb3VibGVUYXAoYXJnMTogR2VzdHVyZUV2ZW50RGF0YSkge1xuICAgICAgICBjb25zb2xlLmxvZygnZG91YmxlIHRhcCcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbG9uZ1ByZXNzRG9uZSA9IHRydWU7XG5cbiAgICBwdWJsaWMgbG9uZ1ByZXNzKGFyZzE6IEdlc3R1cmVFdmVudERhdGEpIHtcbiAgICAgICAgLy9kaWFsb2dzLmFjdGlvbihcIllvdXIgbWVzc2FnZVwiLCBcIkNhbmNlbCBidXR0b24gdGV4dFwiLCBbXCJPcHRpb24xXCIsIFwiT3B0aW9uMlwiLCBcIk9wdGlvbjJcIiwgXCJPcHRpb24yXCIsIFwiT3B0aW9uMlwiLCBcIk9wdGlvbjJcIiwgXCJPcHRpb24yXCIsIFwiT3B0aW9uMlwiLCBcIk9wdGlvbjJcIiwgXCJPcHRpb24yXCJdKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKFwiRGlhbG9nIHJlc3VsdDogXCIgKyByZXN1bHQpXG4gICAgICAgIC8vfSk7XG5cbiAgICAgICAgLy90aGlzLmRyYXdMaW5rcyh0aGlzLmN1cnJlbnROYXZQYWdlLmxpbmtJdGVtcyk7XG5cbiAgICAgICAgc3dpdGNoIChhcmcxLmlvcy5zdGF0ZSkge1xuICAgICAgICAgICAgY2FzZSBHZXN0dXJlU3RhdGVUeXBlcy5iZWdhbjpcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0luRWRpdE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGl0RWRpdE1vZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW50ZXJFZGl0TW9kZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxvbmdQcmVzc0RvbmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgR2VzdHVyZVN0YXRlVHlwZXMuY2hhbmdlZDpcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBHZXN0dXJlU3RhdGVUeXBlcy5lbmRlZDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbG9uZ1ByZXNzJyk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmxvbmdQcmVzc0RvbmUgPSB0cnVlLCA1MDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHByaXZhdGUgZW50ZXJFZGl0TW9kZSgpIHtcbiAgICAgICAgdGhpcy5pc0luRWRpdE1vZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmRyYXdMaW5rcyh0aGlzLmN1cnJlbnROYXZQYWdlLmxpbmtJdGVtcyk7XG4gICAgICAgIHRoaXMuc2V0KHRoaXMud3JhcHBlckNsYXNzTmFtZVByb3AsIHRoaXMud3JhcEVkaXRDbGFzc05hbWUpO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBkcmF3TGlua3MobGlua0l0ZW1zOiBBcnJheTxMaW5rSXRlbT4pIHtcblxuICAgICAgICAvKlxuICAgICAgICB2YXIgcHJvID0gbmV3IFByb21pc2UoKHJlcywgcmVqKT0+e1xuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZSA9IHJlcztcbiAgICAgICAgICAgIHRoaXMuX3JlamVjdCA9IHJlajtcbiAgICAgICAgfSk7XG4gICAgICAgICovXG5cbiAgICAgICAgdmFyIHJldFByb21pc2VzID0gW107XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5rSXRlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBsaSA9IGxpbmtJdGVtc1tpXTtcbiAgICAgICAgICAgIHZhciBkcmF3UHJvbWlzZSA9IHRoaXMuZHJhd0xpbmsobGkpO1xuICAgICAgICAgICAgcmV0UHJvbWlzZXMucHVzaChkcmF3UHJvbWlzZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocmV0UHJvbWlzZXMpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZHJhd0xpbmsobGk6IExpbmtJdGVtKSB7XG4gICAgICAgIHZhciByZWxSZWN0ID0gbGkucmVjdC5jaGFuZ2VSYXRpbyhsaS5wYXJlbnRTaXplLCB0aGlzLnBhZ2VTaXplKCkpO1xuXG4gICAgICAgIHZhciBsdiA9IG5ldyBMaW5rVmlldyhsaSwgcmVsUmVjdCwgKCkgPT4gdGhpcy5zaG93TGlua1BpY2tlcihsdiwgbGkpKTtcbiAgICAgICAgbHYub3BhY2l0eSA9IDA7XG4gICAgICAgIHRoaXMubGlua1ZpZXdzLnB1c2gobHYpO1xuICAgICAgICB0aGlzLmxheW91dC5hZGRDaGlsZChsdik7XG4gICAgICAgIHJldHVybiBsdi5mYWRlSW4oKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGV4aXRFZGl0TW9kZSgpIHtcbiAgICAgICAgdGhpcy5pc0luRWRpdE1vZGUgPSBmYWxzZTtcblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGlua1ZpZXdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbHYgPSB0aGlzLmxpbmtWaWV3c1tpXTtcblxuICAgICAgICAgICAgdGhpcy5yZW1vdmVMaW5rVmlldyhsdik7XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICBsdi5mYWRlT3V0KCkudGhlbigoKT0+e1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGF5b3V0LnJlbW92ZUNoaWxkKGx2KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGV4KSB7IH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgKi9cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpbmtWaWV3cyA9IFtdO1xuICAgICAgICB0aGlzLnNldCh0aGlzLndyYXBwZXJDbGFzc05hbWVQcm9wLCBcIlwiKTtcbiAgICB9XG5cblxuICAgIHB1YmxpYyBzaG93TGlua1BpY2tlcihsdjogTGlua1ZpZXcsIGxpOiBMaW5rSXRlbSkge1xuICAgICAgICB2YXIgZnVsbHNjcmVlbjogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAgICAgdGhpcy5wYWdlLnNob3dNb2RhbChcIi4vbGlua1BpY2tlclwiLCBsaS5uYW1lLCAoYXJnczogTGlua1BpY2tlckNsb3NlZEV2ZW50QXJncykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJyb290UGFnZSByZWNlaXZlZCBMaW5rUGlja2VyQ2xvc2VkRXZlbnRBcmdzXCIpO1xuICAgICAgICAgICAgaWYgKGFyZ3MuY2FuY2VsZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChhcmdzLmxpbmtEZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpSWR4ID0gdGhpcy5jdXJyZW50TmF2UGFnZS5saW5rSXRlbXMubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmlkOyB9KS5pbmRleE9mKGxpLmlkKTtcblxuICAgICAgICAgICAgICAgIC8vdmFyIGxpSWR4ID0gdGhpcy5jdXJyZW50TmF2UGFnZS5saW5rSXRlbXMuaW5kZXhPZihsaSk7XG4gICAgICAgICAgICAgICAgdmFyIGx2SWR4ID0gdGhpcy5saW5rVmlld3MubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmxpbmtJdGVtLmlkOyB9KS5pbmRleE9mKGx2LmxpbmtJdGVtLmlkKTtcblxuICAgICAgICAgICAgICAgIC8vdmFyIGx2SWR4ID0gdGhpcy5saW5rVmlld3MuaW5kZXhPZihsdik7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50TmF2UGFnZS5saW5rSXRlbXMuc3BsaWNlKGxpSWR4LCAxKTtcblxuICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlTGlua1ZpZXcobHYpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlua1ZpZXdzLnNwbGljZShsdklkeCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsaS5uYW1lID0gYXJncy5zZWxlY3RlZE5hbWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSwgZnVsbHNjcmVlbik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSByZW1vdmVMaW5rVmlldyhsdjogTGlua1ZpZXcpIHtcbiAgICAgICAgLy92YXIgbHZJZHggPSB0aGlzLmxpbmtWaWV3cy5pbmRleE9mKGx2KTtcbiAgICAgICAgLy90aGlzLmxpbmtWaWV3cy5zcGxpY2UobHZJZHgsMSk7XG4gICAgICAgIGx2LmZhZGVPdXQoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYXlvdXQucmVtb3ZlQ2hpbGQobHYpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgZmFpbGVkIHJlbW92aW5nIGx2IGZyb20gbGF5b3V0LiAke2V4Lm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgcHJpdmF0ZSBzZXRJbWFnZShuYW1lOiBzdHJpbmcpIHtcblxuICAgICAgICB0aGlzLmltYWdlVmlldyA9IG5ldyBJbWFnZVZpZXcoKTtcblxuICAgICAgICB0aGlzLmltYWdlVmlldy5zcmMgPSBcIn4vaW1hZ2VzL1wiICsgbmFtZSArIFwiLnBuZ1wiO1xuICAgICAgICB0aGlzLmxheW91dC5hZGRDaGlsZCh0aGlzLmltYWdlVmlldyk7XG5cbiAgICAgICAgLypcbiAgICAgICAgdGhpcy5wYWdlSW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgIHRoaXMucGFnZUltZy5zcmMgPSBcIn4vaW1hZ2VzL1wiICsgbmFtZSArIFwiLnBuZ1wiO1xuICAgICAgICB0aGlzLmxheW91dC5hZGRDaGlsZCh0aGlzLnBhZ2VJbWcpO1xuICAgICAgICAqL1xuICAgICAgICAvL3RoaXMucGFnZUltZy5pbWFnZVNvdXJjZSA9IGltYWdlU291cmNlTW9kdWxlLmZyb21SZXNvdXJjZShuYW1lICsgXCIucG5nXCIpO1xuICAgICAgICAvL3RoaXMucGFnZUltZy5zdHJldGNoID0gZW51bXNNb2R1bGUuU3RyZXRjaC5hc3BlY3RGaXQ7XG4gICAgfVxufVxuXG52YXIgcGMgPSBuZXcgUm9vdFBhZ2VDb250cm9sbGVyKCk7XG5leHBvcnRzLnBhZ2VMb2FkZWQgPSAoYXJncykgPT4gcGMucGFnZUxvYWRlZChhcmdzKTtcbmV4cG9ydHMubmF2aWdhdGluZ1RvID0gKGFyZ3MpID0+IHBjLm5hdmlnYXRpbmdUbyhhcmdzKTsiXX0=